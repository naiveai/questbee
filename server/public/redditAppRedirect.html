<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Logging in to server...</title>

        <style>
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
                width: 100%
            }

            body {
                display: table;
            }

            #message {
                text-align: center;
                display: table-cell;
                vertical-align: middle;
            }

            #real-message {
                display: none;
            }
        </style>

        <script defer src="/__/firebase/6.2.0/firebase-app.js"></script>
        <script defer src="/__/firebase/6.2.0/firebase-functions.js"></script>
        <script defer src="/__/firebase/init.js"></script>
    </head>
    <body>
        <div id="message">
            <div id="loading-message">
                <p>Verifying your Reddit account in our servers...</p>
                <p>This may take some time.</p>
                <br/><br/><br/>
                <p>If you denied permissions, don't worry, we still can't access your account.</p>
            </div>

            <p id="real-message"></p>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var params = new URLSearchParams(window.location.search);

                firebase.functions().httpsCallable("appRedditFirebaseAuth")({
                    error: params.get('error'),
                    code: params.get('code'),
                    state: params.get('state'),
                }).then(function (result) {
                    if (result.data.redirect) {
                        window.location = result.data.redirect;
                    } else if (result.data.message) {
                        document.getElementById("loading-message").style.display = "none";

                        messageElement = document.getElementById("real-message")
                        messageElement.textContent = result.data.message;
                        messageElement.style.display = "block";
                    }
                });
            });
        </script>
    </body>
</html>
